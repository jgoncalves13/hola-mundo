<script>
  const tenant = "keyruspt.eu.qlikcloud.com";
  const clientId = "1bcfdbe59d689c9dfd05f168ff04f6a8";
  const redirectUri = window.location.href;
  const state = "test123"; // Puedes generar algo aleatorio tambi√©n

  function authenticate() {
    const authUrl = `https://${tenant}/login/oauth2/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=openid%20email%20profile&state=${state}`;
    window.location.href = authUrl;
  }

  function getAccessTokenFromUrl() {
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    return params.get("access_token");
  }

  const accessToken = getAccessTokenFromUrl();

  if (!accessToken) {
    authenticate();
  } else {
    document.getElementById("qlikFrame").src =
      `https://${tenant}/single/?appid=2600467e-7e6c-4c36-9fb4-2139caa1cb4d&theme=classic&opt=ctxmenu,currsel&qlik-token=${accessToken}`;
  }
</script>
